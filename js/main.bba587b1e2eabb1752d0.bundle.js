(self.webpackChunklockstep=self.webpackChunklockstep||[]).push([[179],{531:(t,e,n)=>{var r=n(889)((function(t){return t[1]}));r.push([t.id,".container{border:5px solid #d3d5db}.box{height:40px;width:calc(var(--width) * 1px);position:relative}.center-mark,.left,.right{left:calc(var(--pos) * 1px);top:50%;transform:translate(-50%, -50%);cursor:pointer;position:absolute}.center-mark{width:5px;height:30px;background:#d3d5db}.left,.right{width:0;height:0;border:15px solid #0000}.left{border-right-color:#d3d5db;border-left:unset}.right{border-left-color:#d3d5db;border-right:unset}.text{top:50%;left:50%;transform:translate(-50%, -50%);position:absolute;font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:25px;color:#858a99;text-transform:capitalize}\n",""]),r.locals={container:"container",box:"box","center-mark":"center-mark",left:"left",right:"right",text:"text"},t.exports=r},663:(t,e,n)=>{var r=n(889)((function(t){return t[1]}));r.push([t.id,".render-box{width:calc(var(--width) * 1px);height:calc(var(--height) * 1px);position:relative;border:5px solid #d3d5db;overflow:hidden;display:inline-block}.render-unit{width:20px;height:20px;position:absolute;top:calc(var(--x) * 1px);left:calc(var(--y) * 1px);transform:translate(-50%, -50%);background-color:#d3d5db;color:#d3d5db}.render-unit::after{content:var(--name);text-align:center;height:0;top:-20px;left:50%;transform:translateX(-50%);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:20px;position:absolute}\n",""]),r.locals={"render-box":"render-box","render-unit":"render-unit"},t.exports=r},748:(t,e,n)=>{var r=n(889)((function(t){return t[1]}));r.push([t.id,"body{margin:0;background:#282b33}.rendering-container{top:50%;left:50%;position:absolute;white-space:nowrap;transform:translate(-50%, -50%)}.player-render{display:inline-block}\n",""]),r.locals={"rendering-container":"rendering-container","player-render":"player-render"},t.exports=r},614:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>l});var r=n(58),o=n.n(r),i=n(531),a=n.n(i),s={insert:"head",singleton:!1};o()(a(),s);const l=a().locals||{}},107:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>l});var r=n(58),o=n.n(r),i=n(663),a=n.n(i),s={insert:"head",singleton:!1};o()(a(),s);const l=a().locals||{}},536:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>l});var r=n(58),o=n.n(r),i=n(748),a=n.n(i),s={insert:"head",singleton:!1};o()(a(),s);const l=a().locals||{}},64:t=>{"use strict";t.exports={SIMULATION_STEP_TIME:16,PLAYER_ACCELERATION:5e-5,SCALE:100,RENDER_VIEWPORT:{x:-200,y:-200,width:400,height:400},RENDER_SCALE:1.5,LATENCY_MAX:1e3}},138:(t,e,n)=>{"use strict";const r=n(881),o=["A","B"].map((t=>{const e=r("in"),n=r("out");return{name:t,latency:{in:e.latency,out:n.latency},latencyRender:{in:e.component,out:n.component}}})),i=n(662)(o);function a(t,e){return{x:t,y:e}}const s=n(839),l=n(674),c={players:o,unitState:[a(-20,0),a(20,0)].map((t=>({position:t,velocity:a(0,0),input:s.defaultInput})))},u=[{up:"w",left:"a",down:"s",right:"d"},{up:"i",left:"j",down:"k",right:"l"}].map(((t,e)=>s({inputHandler:l(t),network:i,players:o,id:e,initialState:c})));u.forEach((t=>t.start()));const{mod:d,m:p}=n(451),h=d("player",((t,e,r,i)=>{t(n(536)),e(n(479));const a=i.attrs.id;return e(o[a].latencyRender.in),e(o[a].latencyRender.out),{view:()=>r._.playerRender(r.latencyin(),r.latencyout(),r.render({state:u[a].state()}))}})),f=d("root",((t,e,r)=>(t(n(536)),e(n(479)),e(h),{view:()=>r._.renderingContainer(...u.map(((t,e)=>r.player({id:e}))))})));p.mount(document.body,f.component),console.log(o),function t(){p.redraw(),requestAnimationFrame(t)}()},674:t=>{"use strict";const e=new Set;document.addEventListener("keydown",(t=>e.add(t.key))),document.addEventListener("keyup",(t=>e.delete(t.key))),t.exports=function(t){return{current(){const n={};return Object.entries(t).forEach((([t,r])=>n[t]=e.has(r))),n}}}},881:(t,e,n)=>{"use strict";const{mod:r}=n(451);function o(t,e){return 2*Math.random()*e+t-e}const{RENDER_VIEWPORT:i,RENDER_SCALE:a,LATENCY_MAX:s}=n(64),l=i.width*a,c=l/s;t.exports=function(t){let e=o(500,250),i=250*Math.random();let a=null,u=null;document.addEventListener("mousemove",(t=>{if(null!=u){const n=(t.clientX-u)/c;"left"==a?i-=n:"center"==a?e+=n:"right"==a&&(i+=n),i=Math.max(i,0),e=Math.min(Math.max(e,i+60),s-i-60)}u=t.clientX})),document.addEventListener("mouseup",(()=>a=null));return{component:r(`latency${t}`,((r,o,s)=>(r(n(614)),{view:()=>s._.container(s._.box({style:{__width:l}},s._.text(`${t}put lag controls`),s._.centerMark({style:{__pos:e*c},onmousedown:()=>(a="center",!1)}),s._.left({style:{__pos:(e-i-40)*c},onmousedown:()=>(a="left",!1)}),s._.right({style:{__pos:(e+i+40)*c},onmousedown:()=>(a="right",!1)})))}))),latency:()=>o(e,i)}}},839:(t,e,n)=>{"use strict";const{SIMULATION_STEP_TIME:r}=n(64),o=n(446),{arr:i}=n(891),a={up:!1,left:!1,down:!1,right:!1};t.exports=function({inputHandler:t,network:e,players:n,id:s,initialState:l}){const c=[l],u=[i(n.length,(()=>null))],d=performance.now(),p=e.handle(s);let h=0,f=a,m=!1;return{state:()=>c[h],start(){!function e(){const a=t.current();Object.entries(a).some((([t,e])=>e!==f[t]))&&p.broadcast({tick:h,input:a}),f=a;p.poll().forEach(((t,e)=>t.forEach((t=>{h=Math.min(h,t.tick),u[t.tick][e]=t.input}))));const s=Math.ceil((performance.now()-d)/r);for(;h<s;)c[h+1]=o(c[h],u[h]),void 0===u[h+1]&&(u[h+1]=i(n.length,(()=>null))),h++;m||requestAnimationFrame(e)}()},stop(){m=!0}}},t.exports.defaultInput=a},479:(t,e,n)=>{"use strict";const{mod:r}=n(451),{RENDER_VIEWPORT:o,RENDER_SCALE:i}=n(64);t.exports=r("render",((t,e,r)=>(t(n(107)),{view(t){const e=t.attrs.state;return r._.renderBox({style:{__width:i*o.width,__height:i*o.height}},e.unitState.map((({position:t},n)=>r._.renderUnit({style:{__x:(t.x-o.x)*i,__y:(t.y-o.y)*i,__name:`'${e.players[n].name}'`}}))))}})))},451:(t,e,n)=>{"use strict";const r=n(22),o=n(216),i=n(367),a=o({h:r,textConvert:t=>`${t}`,combineId:!0,combineClasses:!0}),s=i(a,{partialApply:!0,useDefault:!0});t.exports={mod:s,m:r,HTML:a}},446:(t,e,n)=>{"use strict";const{SIMULATION_STEP_TIME:r,PLAYER_ACCELERATION:o}=n(64);function i(t,e){return{x:t.x*e,y:t.y*e}}function a(t,e){return{x:t.x+e.x,y:t.y+e.y}}function s(t){function e(t){return t?1:0}function n(t){return t?-1:0}return i({x:e(t.down)+n(t.up),y:e(t.right)+n(t.left)},o)}t.exports=function(t,e){return{players:t.players,unitState:t.unitState.map(((t,n)=>{const o=null===e[n]?t.input:e[n];return{position:a(t.position,i(t.velocity,r)),velocity:a(t.velocity,i(s(o),r)),input:o}}))}}},891:t=>{"use strict";t.exports={arr:(t,e)=>Array(t).fill(null).map((()=>e()))}},662:(t,e,n)=>{"use strict";const{arr:r}=n(891);t.exports=function(t){const e=t.length,n=r(e,(()=>r(e,(()=>[]))));return{handle(o){const i={broadcast(e){t.forEach(((t,n)=>i.send(e,n)))},send(e,r){const i=r===o?0:t[r].latency.in()+t[o].latency.out();i>0?setTimeout((()=>n[r][o].push(e)),i):n[r][o].push(e)},poll(){const t=n[o];return n[o]=r(e,(()=>[])),t}};return i}}}}},t=>{t.O(0,[719,250,175],(()=>{return e=138,t(t.s=e);var e}));t.O()}]);